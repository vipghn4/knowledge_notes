---
title: 17. File system implementation
tags: Operating system
---

<!-- TOC titleSize:1 tabSpaces:2 depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 skip:0 title:1 charForUnorderedList:* -->
# Table of Contents
- [Table of Contents](#table-of-contents)
- [Mass-storage structure](#mass-storage-structure)
  - [Overview of mass-storage structure](#overview-of-mass-storage-structure)
    - [Magnetic disks](#magnetic-disks)
    - [Magnetic tapes](#magnetic-tapes)
  - [Disk structure](#disk-structure)
- [Appendix](#appendix)
  - [Concepts](#concepts)
<!-- /TOC -->

# Mass-storage structure
## Overview of mass-storage structure
### Magnetic disks
**Magnetic disks**. Provide the bulk of mass storage for modern computer systems

<div style="text-align:center">
    <img src="https://i.imgur.com/NiTA1zn.png">
    <figcaption>Moving-head disk mechanism</figcaption>
</div>

* *Disk*. Conceptually, each disk platter has a flat circular shape, like a CD
    * *Common platter diameters*. Range from 1.8 to 5.25 inches
    * *Platter surfaces*. The two surfaces of a platter are covered with a magnetic material
* *Read-write heads*. A read-write head flies just above each surface of every platter
    * *Disk arm*. The heads are attached to a disk arm moving all the heads as a unit
* *Tracks*. The surface of a platter is logically divided into circular tracks, which are subdivided into sectors

    $\to$ Each track may contain hundreds of sectors
* *Cylinder*. The set of tracks, which are at one arm position, makes up a cylinder

    $\to$ There may be thousands of concentric cylinders in a disk drive
* *Storage capacity of common disk drives*. Measured in gigabytes

**Performance measures**. When the disk is in use, a drive motor spins it at high speed

$\to$ Most drives rotate 60 to 200 times per second
* *Disk speed*. Have two parts, i.e. the transfer rate, and the positioning time
* *Transfer rate*. The rate, at which data flow between the drive and the computer
    * *Typical transfer rate*. Several megabytes of data per second
* *Positioning time*. Sometimes called the random-access time, consist of two parts
    * *Seek time*. The time necessary to move the disk arm to the desired cylinder
    * *Rotational latency*. The time necessary for the desired sector to rotate the disk head
    * *Typical seek times and rotaitonal latencies*. Several milliseconds

**Head crash**. Since the disk head flies on an extremely thin cushion of air, measured in microns

$\to$ There is a danger that the head will make contact with the disk surface
* *Head crash*. Although the disk platters are coated with a thin protective layer, the head will sometimes damage the magnetic surface

    $\to$ This accident is called a head crash
* *Consequence*. A head crash normally cannot be repaired

    $\to$ The entire disk must be replaced

**Removable disks**. A disk can be removable, allowing different disks to be mounted as needed
* *Disk structure*. Removable magnetic disks generally consist of one platter, held in a plastic case to prevent damage while not in the disk drive
* *Floppy disks*. Inexpensive removable magnetic disks, which have a soft plastic case containing a flexible platter
    * *Disk head*. The head of a floppy-disk drive generally sits directly on the disk surface

        $\to$ The drive is designed to rotate more slowly than a hard-disk drive, to reduce the wear on the disk surface
    * *Storage capacity*. Typically only 1.44 MB or so
* *Availability and capacity*. Removable disks are available working much like normal hard disks, and have capacities measured in gigabytes

**I/O bus**. A disk drive is attached to a computer by a set of wires, called an I/O bus
* *Types of buses*.
    * Enhanced integrated drive electronic (EIDE)
    * Advanced technology attachment (ATA)
    * Serial ATA (SATA)
    * Universal serial bus (USB)
    * Fiber channel (FB)
    * Small computer-systems interface (SCSI)

**Controller**. Data transfers on a bus are carried out by special electronic processors, called controllers
* *Host controller*. The controller at the computer end of the bus
* *Disk controller*. Built into each disk drive

**Data transfer procedure**. To perform a disk I/O operation

<div style="text-align:center">
    <img src="https://i.imgur.com/mHm2DJO.png">
    <figcaption>Hybrid HDD</figcaption>
</div>

1. The computer places a command into the host controller, typically using memory-mapped I/O ports
2. The host controller sends the command via messages to the disk controller
3. The controller operates the disk-drive hardware to carry out the command
4. Disk controllers usually have a built-in cache
    * *Data transfer at the disk drive*. Happen between the cache and the disk surface
    * *Data transfer to the host*. Occur between the cache and the host controller, at fast electronic speed

### Magnetic tapes
**Magtenic tape**. Used as an early mass-storage medium

<div style="text-align:center">
    <img src="https://i.imgur.com/6mjeSt2.png">
    <figcaption>Magnetic tapes</figcaption>
</div>

* *Pros and cons*.
   * *Pros*. Relatively permanent and can hold large quantities of data
   * *Cons*. Access time is slow, compared with that of main memory and magnetic disk
* *Random access to magnetic tape*. Thousand times slower than that of magnetic disk

$\to$ Tapes are not very useful for mass storage
* *Usage*. Mainly for backup, storage of infrequently used information, and as a medium for transferring information from one system to another

**Tape structure**. A tape is kept in a spool, and is wound or rewound past a read-write head

<div style="text-align:center">
    <img src="https://i.imgur.com/HoLmPSl.png">
    <figcaption>Magnetic tape structure</figcaption>
</div>

* *Write speed*. Moving to the correct spot on a tape can take minutes

    $\to$ But once positioned, tape drives can write data at speeds comparable to disk drives
* *Tape capacity*. Vary greatly, depending on the particular type of tape drive
    * *Range*. Typically from 20 GB to 200 GB
* *Data compression*. Some tape has built-in compression, which can more than double the effective storage

## Disk structure
**Logical block (cluster)**. Modern disk drives are addressed as large 1D arrays of logical blocks, where the logical block is the smallest unit of transfer
* *Typical logical block sizes*. Usually 512 bytes, although some disks can be low-level formatted to have different logical block size, e.g. 1024 bytes
* *Implementation*. The 1D array of logical blocks is mapped onto the sectors of the disk sequentially
    * *Sector order*. Sector 0 is the first sector of the first track on the outermost cylinder

        $\to$ The mapping proceeds in order through that track, then through the rest of the tracks in that cylinder, then through the rest of the cylinders from the outermost to the innermost
* *Logical block number to old-style disk address translation*. We can, in principle, convert a logical block number into an old-style disk address
    * *Old-style disk address*. Consist of a cylinder number, a track number within that cylinder, and a sector number within that track
    * *Difficulties*. In practice, it is difficult to perform this translation, i.e.
        * Most disks have some defective sectors, but the mapping hides this by substituting spare sectors from elsewhere on the disk
        * The number of sectors per track is not constant on some drives

**Constant linear velocity (CLV) and constant angular velocity (CAV)**.
* *Constant linear velocity (CLV)*. On media using CLV, the density of bits per track is uniform
    * *Explain*. The farther a track is from the center of the disk, the greater its length, thus the more sector in can hold

        $\to$ As we move from outer zones to inner zones, the number of sectors per track decreases
        * *Consequence*. Tracks in the outermost zone typically hold 40% more sectors than do tracks in the innermost zone
    * *Consequence*. The drive increases its rotation speed as the head moves from the outer to the inner tracks to keep the same rate of data moving under the head
    * *Usage*. Used in CD-ROM, and DVD-ROM drives
* *Constant angular velocity (CAV)*. The disk rotation speed can stay constant, i.e. the density of bits decreases from inner tracks to outer tracks to keep the data rate constant
    * *Usage*. In hard disks

# Appendix
## Concepts
**Cluster (file systems)**. Also called allocation unit, or block, i.e. in many disk drives, sectors usually are grouped into clusters, or logical blocks, which function as the smallest data unit permitted
* *Definition*. A unit of disk space allocation for files and directories
    * *Explain*. To reduce the overhead of managing on-disk data structures, the file system does not allocate individual disk sectors by default

        $\to$ It allocates contiguous groups of sectors, called clusters
* *Cluster allocation*. A cluster is the smallest logical amount of disk space, which can be allocated to a file

    $\to$ Storing small files on a file system with large clusters will waste disk space
    * *Slack space*. The wasted disk space within a cluster
* *Cluster size effects*. Typically range from 1 sector (512 bytes) to 128 sectors (64 KiB)
    * *Small cluster sizes*. Cluster sizes small relative to the average file size will make the wasted space per file statistically about half of the cluster
    * *Large cluster sizes*. 
        * The wasted space will become greater
        * Reduce book-keeping overhead and fragmentation, leading to faster reading and writing speed overall
* *Physical continuity of a cluster*. A cluster need not be physically contiguous on the disk
    * *Explain*.
        * A cluster may span more than one track
        * If sector interleaving is used, maybe discontiguous within a track
    * *Clustering and fragmentation*. Clustering should not be confused with fragmentation
        * *Explain*. Sectors are still logically contiguous, while fragmentation does not
* *Lost cluster*. Occur when a file is removed form the directory listing, but the file allocation table (FAT) still shows the clusters allocated to the file

**More about logical block**.
* *From "Federal information processing standards publication (FIPS PUB 97)"*. 
    * *Logical block*. A block of data, which is the normal unit of information read or recorded during READ or WRITE operations
    * *Logical address*. Each logical block is uniquely identified by a 32-bit logical address

        $\to$ Logically successive blocks are identified by successive logical address
    * *Physical block*. The smallest unit of data, which may be physically independently written on a disk drive
        * *Block structure*. Contain an ID area, and a data area
            * *Data area*. May be less than, equal to, or more than one logical block
        * *Logical-to-physical-block mapping*. Defined in the vendor's documentation
    * *Physical address*. The addess of a block, i.e. logical or physical, which is meaningful in terms of the physical structure of a disk drive